<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <title>ApproVideo - Tagged Content</title>
</head>
<body class="bg-gray-50">
  <!-- Top Banner -->
  <div class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-2 px-4 text-center text-sm">
    ðŸŽ¥ ApproVideo - Tagged Content
  </div>

  <div class="container mx-auto p-4">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg rounded-lg mb-8">
      <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <a href="index.html" class="flex items-center space-x-3">
          <i class="fas fa-arrow-left text-gray-600"></i>
          <span class="font-medium text-gray-700">Back to Library</span>
        </a>
        <div id="searchInfo" class="flex items-center space-x-2">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </nav>

    <!-- Video Grid -->
    <div id="videoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Will be populated by JavaScript -->
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Initialize Supabase
    const supabase = createClient(
      'https://vlvbodwrtblttvwnxkjx.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsdmJvZHdydGJsdHR2d254a2p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY3NDk2NzIsImV4cCI6MjAwMjMyNTY3Mn0.TRT1HeX85vP1zDxnU7qBz5GqNPgYZUj-BOdek4qmtEg'
    );

    async function initialize() {
      const searchCategory = await localforage.getItem('searchCategory');
      const searchTag = await localforage.getItem('searchTag');
      
      // Update search info display
      const searchInfo = document.getElementById('searchInfo');
      if (searchCategory) {
        searchInfo.innerHTML = `
          <i class="fas fa-folder text-gray-600"></i>
          <span class="font-medium text-gray-700">Category: ${searchCategory}</span>
        `;
        loadVideos({ type: searchCategory });
      } else if (searchTag) {
        searchInfo.innerHTML = `
          <i class="fas fa-tag text-gray-600"></i>
          <span class="font-medium text-gray-700">Tag: ${searchTag}</span>
        `;
        loadVideos({ tag: searchTag });
      }
    }

    async function loadVideos({ type, tag }) {
      try {
        let query = supabase.from('Video').select('*');
        
        if (type) {
          query = query.eq('type', type);
        }
        if (tag) {
          query = query.contains('tags', [tag]);
        }

        const { data: videos, error } = await query;
        if (error) throw error;

        renderVideos(videos);
      } catch (error) {
        console.error('Error loading videos:', error);
      }
    }

    function renderVideos(videos) {
      const videoGrid = document.getElementById('videoGrid');
      
      if (!videos || videos.length === 0) {
        videoGrid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fas fa-search text-gray-400 text-4xl mb-4"></i>
            <p class="text-gray-500">No videos found</p>
          </div>
        `;
        return;
      }

      videoGrid.innerHTML = videos.map(video => createVideoCard(video)).join('');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initialize);
  </script>
</body>
</html>