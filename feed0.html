<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ApproVideo Video Portal Manager - Feed</title>
  <link href="style.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1>Feed</h1>

    <div id="output-container"></div>

    <script type="module">
    const APP_CONFIG = {
      supabase: {
        url: 'https://vlvbodwrtblttvwnxkjx.supabase.co',
        key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsdmJvZHdydGJsdHR2d254a2p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY3NDk2NzIsImV4cCI6MjAwMjMyNTY3Mn0.TRT1HeX85vP1zDxnU7qBz5GqNPgYZUj-BOdek4qmtEg'
      },
      categories: {
        diy: { icon: 'fa-home', color: 'from-blue-500 to-indigo-600', anim: 'float-1' },
        'drinking-water': { icon: 'fa-tint', color: 'from-cyan-500 to-blue-600', anim: 'float-2' },
        'waste-management': { icon: 'fa-recycle', color: 'from-green-500 to-emerald-600', anim: 'float-3' },
        'energy-systems': { icon: 'fa-solar-panel', color: 'from-yellow-500 to-amber-600', anim: 'float-4' },
        'natural-health': { icon: 'fa-tools', color: 'from-purple-500 to-indigo-600', anim: 'float-5' },
        food: { icon: 'fa-seedling', color: 'from-emerald-500 to-green-600', anim: 'float-6' }
      }
    };


const supabase = createClient(APP_CONFIG.supabase.url, APP_CONFIG.supabase.key);

async function getVideos() {
  try {
    // 1. Fetch data from the 'Video' table
    const { data: videos, error: videoError } = await supabase
      .from('Video')
      .select('*');

    if (videoError) {
      throw videoError;
    }

    // 2. Fetch data from the 'Step' table
    const { data: stepsData, error: stepsError } = await supabase
      .from('Step') 
      .select('*');

    if (stepsError) {
      throw stepsError;
    }

    // 3. Fetch data from the 'Panel' table
    const { data: panelsData, error: panelsError } = await supabase
      .from('Panel') 
      .select('*');

    if (panelsError) {
      throw panelsError;
    }

    // 4. Transform the data into the desired format (with checks for missing data)
    const formattedVideos = videos.map(video => {
      const videoSteps = stepsData
        .filter(step => step.video_id === video.id)
        .map(step => step.text) || []; 

      const videoPanels = panelsData
        .filter(panel => panel.video_id === video.id)
        .map(panel => ({
          title: panel.title,
          content: panel.content
        })) || []; 

      return {
        id: video.id.toString(), // Ensure ID is a string
        title: video.title,
        categories: video.categories ? video.categories.split(', ') : [],
        description: video.description,
        youtubeId: video.youtubeId,
        tags: video.tags ? video.tags.split(', ') : [],
        rating: video.rating,
        date: video.datePublished, 
        transcript: video.transcript,
        materials: video.materials ? video.materials.split(', ') : [],
        steps: videoSteps,
        panels: videoPanels
      };
    });

    return formattedVideos;

  } catch (error) {
    console.error('Error fetching videos:', error);
    return []; 
  }
}

      



      
      

      async function getFeedData() {
        const response = await fetch('/api/feed'); // Fetch from your Vercel API route
        return response.json(); 
      }

      async function initializeApp() {
        try {
          const feedData = await getFeedData();
          displayFeedJson(feedData);
        } catch (error) {
          console.error('Failed to initialize app:', error);
        }
      }

      document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
  </div>
</body>
</html>
