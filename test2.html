<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AfroAdmin Homepage</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@^2.0/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/supabase-js@^1.0"></script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
  <nav class="bg-blue-800 p-4">
    <div class="container mx-auto flex justify-between">
      <div class="text-white font-bold text-xl">AfroAdmin</div>
      <div>
        <button id="logout-button" class="bg-red-600 hover:bg-red-800 text-white py-1 px-4 rounded">Logout</button>
      </div>
    </div>
  </nav>

  <div id="dynamic-area" class="container mx-auto mt-10 px-4">
    <!-- This section will be populated dynamically -->
  </div>

  <script>

    const supabaseUrl = "https://vlvbodwrtblttvwnxkjx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsdmJvZHdydGJsdHR2d254a2p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY3NDk2NzIsImV4cCI6MjAwMjMyNTY3Mn0.TRT1HeX85vP1zDxnU7qBz5GqNPgYZUj-BOdek4qmtEg";
    const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

    async function fetchHomepageData() {
      try {
        const { data: profiles } = await supabase.from('profiles').select('*');
        const { data: videos } = await supabase.from('videos').select('*').eq('featured', true);
        const { data: panels } = await supabase.from('panels').select('*');
        
        if (profiles && videos && panels) {
          renderHomepage(profiles, videos, panels);
        }
      } catch (error) {
        console.error('Error fetching homepage data:', error);
      }
    }

    function renderHomepage(profiles, videos, panels) {
      const dynamicArea = document.getElementById('dynamic-area');
      dynamicArea.innerHTML = "";

      // Display featured profiles
      const profilesSection = document.createElement('div');
      profilesSection.classList.add('bg-white', 'shadow-md', 'rounded', 'p-6', 'mb-10');
      profilesSection.innerHTML = "<h2 class='text-2xl font-bold mb-4'>Featured Profiles</h2>";

      profiles.forEach(profile => {
        profilesSection.innerHTML += `
          <div class="mb-4">
            <h3 class="text-xl font-semibold">${profile.full_name}</h3>
            <p>Username: ${profile.username}</p>
            <p>Eco Points: ${profile.eco_points}</p>
          </div>
        `;
      });

      dynamicArea.appendChild(profilesSection);

      // Display featured videos
      const videosSection = document.createElement('div');
      videosSection.classList.add('bg-white', 'shadow-md', 'rounded', 'p-6', 'mb-10');
      videosSection.innerHTML = "<h2 class='text-2xl font-bold mb-4'>Featured Videos</h2>";

      videos.forEach(video => {
        videosSection.innerHTML += `
          <div class="mb-4">
            <h3 class="text-xl font-semibold">${video.title}</h3>
            <p>${video.description}</p>
            <a href="https://www.youtube.com/watch?v=${video.youtube_id}" target="_blank" class="text-blue-500">Watch Video</a>
          </div>
        `;
      });

      dynamicArea.appendChild(videosSection);

      // Display panels
      const panelsSection = document.createElement('div');
      panelsSection.classList.add('bg-white', 'shadow-md', 'rounded', 'p-6', 'mb-10');
      panelsSection.innerHTML = "<h2 class='text-2xl font-bold mb-4'>Panels</h2>";

      panels.forEach(panel => {
        panelsSection.innerHTML += `
          <div class="mb-4">
            <h3 class="text-xl font-semibold">${panel.title}</h3>
            <p>${panel.content}</p>
            <div class="flex space-x-2">
              <button class="bg-blue-600 hover:bg-blue-800 text-white py-1 px-4 rounded" onclick="showEditPanelModal('${panel.id}', '${panel.title}', '${panel.content}')">Edit</button>
              <button class="bg-red-600 hover:bg-red-800 text-white py-1 px-4 rounded" onclick="deletePanel('${panel.id}')">Delete</button>
            </div>
          </div>
        `;
      });

      panelsSection.innerHTML += `
        <button class="bg-green-600 hover:bg-green-800 text-white py-2 px-4 rounded" onclick="showAddPanelModal()">Add Panel</button>
      `;

      dynamicArea.appendChild(panelsSection);
    }

    // Show modal to add a new panel
    function showAddPanelModal() {
      const modal = document.createElement('div');
      modal.classList.add('fixed', 'inset-0', 'bg-gray-800', 'bg-opacity-50', 'flex', 'justify-center', 'items-center', 'z-50');
      modal.innerHTML = `
        <div class="bg-white p-6 rounded shadow-md w-full max-w-md">
          <h2 class="text-xl font-bold mb-4">Add New Panel</h2>
          <form id="add-panel-form">
            <div class="mb-4">
              <label for="panel-title" class="block text-sm font-bold mb-2">Title:</label>
              <input type="text" id="panel-title" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
              <label for="panel-content" class="block text-sm font-bold mb-2">Content:</label>
              <textarea id="panel-content" class="w-full p-2 border rounded" required></textarea>
            </div>
            <div class="flex justify-end">
              <button type="button" class="bg-gray-500 hover:bg-gray-700 text-white py-1 px-4 rounded mr-2" onclick="closeModal()">Cancel</button>
              <button type="submit" class="bg-green-600 hover:bg-green-800 text-white py-1 px-4 rounded">Add Panel</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);

      document.getElementById('add-panel-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        await addPanel();
        closeModal();
        fetchHomepageData();
      });
    }

    // Show modal to edit an existing panel
    function showEditPanelModal(panelId, currentTitle, currentContent) {
      const modal = document.createElement('div');
      modal.classList.add('fixed', 'inset-0', 'bg-gray-800', 'bg-opacity-50', 'flex', 'justify-center', 'items-center', 'z-50');
      modal.innerHTML = `
        <div class="bg-white p-6 rounded shadow-md w-full max-w-md">
          <h2 class="text-xl font-bold mb-4">Edit Panel</h2>
          <form id="edit-panel-form">
            <div class="mb-4">
              <label for="edit-panel-title" class="block text-sm font-bold mb-2">Title:</label>
              <input type="text" id="edit-panel-title" class="w-full p-2 border rounded" value="${currentTitle}" required>
            </div>
            <div class="mb-4">
              <label for="edit-panel-content" class="block text-sm font-bold mb-2">Content:</label>
              <textarea id="edit-panel-content" class="w-full p-2 border rounded" required>${currentContent}</textarea>
            </div>
            <div class="flex justify-end">
              <button type="button" class="bg-gray-500 hover:bg-gray-700 text-white py-1 px-4 rounded mr-2" onclick="closeModal()">Cancel</button>
              <button type="submit" class="bg-blue-600 hover:bg-blue-800 text-white py-1 px-4 rounded">Save Changes</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);

      document.getElementById('edit-panel-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        await editPanel(panelId);
        closeModal();
        fetchHomepageData();
      });
    }

    function closeModal() {
      const modal = document.querySelector('.fixed.inset-0');
      if (modal) {
        modal.remove();
      }
    }

    async function addPanel() {
      const title = document.getElementById('panel-title').value;
      const content = document.getElementById('panel-content').value;

      try {
        const { error } = await supabase.from('panels').insert([{ title, content }]);
        if (error) throw error;
      } catch (error) {
        console.error('Error adding panel:', error);
      }
    }

    async function editPanel(panelId) {
      const title = document.getElementById('edit-panel-title').value;
      const content = document.getElementById('edit-panel-content').value;

      try {
        const { error } = await supabase.from('panels').update({ title, content }).eq('id', panelId);
        if (error) throw error;
      } catch (error) {
        console.error('Error editing panel:', error);
      }
    }

    async function deletePanel(panelId) {
      if (!confirm('Are you sure you want to delete this panel?')) return;

      try {
        const { error } = await supabase.from('panels').delete().eq('id', panelId);
        if (error) throw error;
        fetchHomepageData();
      } catch (error) {
        console.error('Error deleting panel:', error);
      }
    }

    // Logout handler
    document.getElementById('logout-button').addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = '/login';
    });

    // Fetch and render homepage data on load
    fetchHomepageData();
  </script>
</body>
</html>

