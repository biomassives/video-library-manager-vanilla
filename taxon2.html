<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>


<title>ApproðŸŽ¥video Video Portal ManagerðŸŽ¥</title>
<link href="style.css" rel="stylesheet">
<!-- Add Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


<style>
    /* Animations */
    @keyframes slideIn {
        from { transform: translateY(-10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .category-item {
        animation: slideIn 0.3s ease-out;
        transition: all 0.3s ease;
    }
    
    .category-item:hover {
        transform: translateY(-2px);
    }
    
    .category-icon {
        transition: all 0.3s ease;
    }
    
    .category-item:hover .category-icon {
        transform: scale(1.1);
    }
    
    /* Custom Scrollbar */
    .subcategories {
        max-height: 200px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #9CA3AF transparent;
    }
    
    .subcategories::-webkit-scrollbar {
        width: 6px;
    }
    
    .subcategories::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .subcategories::-webkit-scrollbar-thumb {
        background-color: #9CA3AF;
        border-radius: 3px;
    }
    
    /* Button Styles */
    .action-button {
        transition: all 0.2s ease;
    }
    
    .action-button:hover {
        transform: scale(1.05);
    }
    
    .action-button:active {
        transform: scale(0.95);
    }
    
    /* Tag Styles */
    .tag-item {
        transition: all 0.3s ease;
    }
    
    .tag-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
         

    .tag-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        padding: 1rem 0;
    }
    
    .tag-item {
        background: white;
        padding: 1rem;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .tag-content {
        flex: 1;
    }
    
    .tag-name {
        font-weight: 600;
        display: block;
        margin-bottom: 0.5rem;
    }
    
    .tag-description {
        font-size: 0.9rem;
        color: #666;
        margin: 0;
    }
    
    
            /* Add new styles for modals */
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }
    
            .modal-content {
                background: white;
                padding: 2rem;
                border-radius: 8px;
                max-width: 500px;
                width: 90%;
            }
    
            .modal form {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
    
            .modal input,
            .modal textarea {
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
    
            /* Loading state */
            .loading {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem;
                color: #666;
            }
    
            .loading::after {
                content: '';
                width: 1.5rem;
                height: 1.5rem;
                border: 2px solid #3498db;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 1s linear infinite;
                margin-left: 0.5rem;
            }
    
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
    
            /* Error state */
            .error {
                background: #fee;
                color: #e74c3c;
                padding: 1rem;
                border-radius: 4px;
                margin-bottom: 1rem;
 

.tag-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    padding: 1rem 0;
}

.tag-item {
    background: white;
    padding: 1rem;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.tag-content {
    flex: 1;
}

.tag-name {
    font-weight: 600;
    display: block;
    margin-bottom: 0.5rem;
}

.tag-description {
    font-size: 0.9rem;
    color: #666;
    margin: 0;
}


        /* Add new styles for modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }

        .modal form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal input,
        .modal textarea {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #666;
        }

        .loading::after {
            content: '';
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error state */
        .error {
            background: #fee;
            color: #e74c3c;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
                
        /* Additional Styles */
        .blueprint-section {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .category-item {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .subcategory-list {
            margin-top: 1rem;
            padding-left: 1.5rem;
        }

        .subcategory-list .item {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .delete-btn:hover {
            background: #dc2626;
        }
        </style>

        </head>
        <body class="bg-gray-50">
        <!-- Top Banner -->
        <div class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-2 px-4 text-center text-sm">
        ðŸŽ¥ Welcome to ApproVideo - Your Sustainable Video Management Portal
        </div>



 <!-- Main Header -->
<header class="bg-white shadow-lg">
    <div class="container mx-auto">
        <!-- Top Banner -->


        <!-- Main Navigation -->
        <nav class="bg-white rounded-lg mb-8 transition-colors duration-300" id="mainNav">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo Section -->
                    <div class="flex items-center space-x-4">
                        <a href="index.html" class="flex items-center space-x-3 group">
                            <svg class="h-10 w-10 text-green-500 transform transition-all duration-300 group-hover:scale-110" 
                                viewBox="0 0 24 24" 
                                fill="none" 
                                stroke="currentColor" 
                                stroke-width="1.5"
                                id="logoIcon">
                                <circle class="tool-circle" cx="12" cy="12" r="10" stroke-dasharray="4 4"/>
                                <path class="tool-wrench" d="M3 21h4l9-9"/>
                                <path class="tool-screwdriver" d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                                <circle class="tool-gear" cx="12" cy="12" r="3"/>
                                <path class="tool-arrows" d="M8 12h8m-4-4v8" stroke-linecap="round"/>
                            </svg>
                            <span class="text-xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                                ApproAdmin
                            </span>
                        </a>
                    </div>

          
                    <!-- Right Navigation Items -->
                    <div class="flex items-center space-x-6">
                        <a href="http://www.approvideo.org" 
                           class="nav-link group flex items-center space-x-2 text-gray-600 hover:text-green-500">
                            <span class="hidden md:inline">Website</span>
                        </a>

                        <button id="darkModeToggle" 
                                class="p-2 rounded-lg transition-all duration-300 hover:bg-opacity-10">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path class="dark-toggle" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>

                        <!-- Profile Button -->
                        <div class="relative">
                            <button id="profileButton" class="p-2 rounded-lg transition-colors duration-300">
                                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5z" />
                                    <path d="M19 21v-2a7 7 0 0 0-7-7h0a7 7 0 0 0-7 7v2" />
                                </svg>
                            </button>
                            <div id="profileDropdown" class="dropdown-inactive absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                                <div class="py-1">
                                    <a href="#" class="block px-4 py-2 text-sm">Your Profile</a>
                                    <a href="#" class="block px-4 py-2 text-sm">Settings</a>
                                    <a href="#" class="block px-4 py-2 text-sm">Sign out</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>

<!-- Content Area -->
<main class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Welcome Section -->
    <div class="bg-white rounded-lg shadow-lg mb-8 p-6 border-l-4 border-green-500">
        <h1 class="text-3xl font-bold mb-2">Welcome to Content Blueprint</h1>
        <p class="text-gray-600">Organize your sustainability and appropriate technology content</p>
    </div>

    <!-- Categories Section -->
    <div class="bg-white rounded-lg shadow-lg mb-8 p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Categories & Subcategories</h2>
            <button class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors" id="add-category-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Category
            </button>
        </div>

        <!-- Category List -->
        <div class="space-y-4">
            <!-- Category Item Template -->
            <div class="category-item bg-gray-50 rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <div class="category-icon w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                            <i class="fas fa-home text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">Shelter</h3>
                            <p class="text-sm text-gray-600">Housing and construction techniques</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                            Add Sub
                        </button>
                        <button class="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                            Delete
                        </button>
                    </div>
                </div>

                <!-- Subcategories -->
                <div class="ml-12 mt-4 space-y-2">
                    <div class="flex justify-between items-center p-2 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-700">Earthbag Construction</span>
                        <button class="text-red-500 hover:text-red-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tags Section -->
    <div class="bg-white rounded-lg shadow-lg mb-8 p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 id="add-tag-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Tag
            </button>
        </div>

        <!-- Tag Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="tag-item bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-semibold">Sustainable</h3>
                        <p class="text-sm text-gray-600">Environmentally conscious practices</p>
                    </div>
                    <button class="text-red-500 hover:text-red-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modal Template -->
<div class="modal-template hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="p-6">
            <h3 class="text-xl font-bold mb-4">Add Category</h3>
            <form class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"/>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Icon Class</label>
                    <input type="text" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"/>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" rows="3"></textarea>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>




        <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabaseUrl = 'https://vlvbodwrtblttvwnxkjx.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsdmJvZHdydGJsdHR2d254a2p4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODY3NDk2NzIsImV4cCI6MjAwMjMyNTY3Mn0.TRT1HeX85vP1zDxnU7qBz5GqNPgYZUj-BOdek4qmtEg';
const supabase = createClient(supabaseUrl, supabaseAnonKey);


// 1  Event System
class EventEmitter {
    constructor() {
        this.events = {};
    }

    on(event, callback) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(callback);
    }

    emit(event, data) {
        if (this.events[event]) {
            this.events[event].forEach(callback => callback(data));
        }
    }
}

// 2 Loading Manager Class
class LoadingManager {
    static show(container) {
        // Clear existing content
        container.innerHTML = `
            <div class="loading">
                Loading...
            </div>
        `;
    }

    static hide(container) {
        // Remove loading indicator if it exists
        const loadingEl = container.querySelector('.loading');
        if (loadingEl) {
            loadingEl.remove();
        }
    }

    static error(container, message) {
        container.innerHTML = `
            <div class="error">
                ${message}
                <button onclick="location.reload()" class="retry-btn">
                    Retry
                </button>
            </div>
        `;
    }

    static progress(container, percentage) {
        container.innerHTML = `
            <div class="loading">
                Loading... ${percentage}%
                <div class="progress-bar">
                    <div class="progress" style="width: ${percentage}%"></div>
                </div>
            </div>
        `;
    }
}


// 3 Blueprint Store Class


// Blueprint Store
class BlueprintStore extends EventEmitter {
    constructor() {
        super();
        this.supabase = supabase;
        this.categories = [];
        this.subcategories = [];
        this.tags = [];
        this.isLoading = false;
        this.error = null;
    }

    async loadInitialData() {
        try {
            this.isLoading = true;
            this.emit('loading', true);
            
            // Load categories with their subcategories
            const { data: categories, error: catError } = await this.supabase
                .from('categories')
                .select(`
                    id,
                    name,
                    slug,
                    icon_class,
                    description,
                    subcategories (
                        id,
                        name,
                        slug,
                        description
                    )
                `);

            if (catError) throw catError;
            console.log('Categories loaded:', categories);
            this.categories = categories || [];

            // Load tags
            const { data: tags, error: tagError } = await this.supabase
                .from('tags')
                .select('*')
                .order('name');

            if (tagError) throw tagError;
            console.log('Tags loaded:', tags);
            this.tags = tags || [];

            this.emit('dataLoaded', { categories: this.categories, tags: this.tags });
        } catch (error) {
            console.error('Error loading data:', error);
            this.error = error.message;
            this.emit('error', error.message);
        } finally {
            this.isLoading = false;
            this.emit('loading', false);
        }
    }

    async addCategory(categoryData) {
        try {
            const { data, error } = await this.supabase
                .from('categories')
                .insert([{
                    name: categoryData.name,
                    slug: categoryData.name.toLowerCase().replace(/\s+/g, '-'),
                    description: categoryData.description || null,
                    icon_class: categoryData.icon_class || null
                }])
                .select();

            if (error) throw error;
            await this.loadInitialData();
            this.emit('categoryAdded', data);
            return data;
        } catch (error) {
            console.error('Error adding category:', error);
            this.emit('error', error.message);
            throw error;
        }
    }

    async deleteCategory(categoryId) {
        try {
            // First delete all subcategories
            await this.supabase
                .from('subcategories')
                .delete()
                .eq('category_id', categoryId);

            // Then delete the category
            const { error } = await this.supabase
                .from('categories')
                .delete()
                .eq('id', categoryId);

            if (error) throw error;
            await this.loadInitialData();
            this.emit('categoryDeleted', categoryId);
        } catch (error) {
            console.error('Error deleting category:', error);
            this.emit('error', error.message);
            throw error;
        }
    }

    async addSubcategory(categoryId, subcategoryData) {
        try {
            const { data, error } = await this.supabase
                .from('subcategories')
                .insert([{
                    category_id: categoryId,
                    name: subcategoryData.name,
                    slug: subcategoryData.name.toLowerCase().replace(/\s+/g, '-'),
                    description: subcategoryData.description || null
                }])
                .select();

            if (error) throw error;
            await this.loadInitialData();
            this.emit('subcategoryAdded', data);
            return data;
        } catch (error) {
            console.error('Error adding subcategory:', error);
            this.emit('error', error.message);
            throw error;
        }
    }

    // Add this method
    async addTag(tagData) {
        try {
            const { data, error } = await this.supabase
                .from('tags')
                .insert([{
                    name: tagData.name,
                    color: tagData.color || null,
                    description: tagData.description || null
                }])
                .select();

            if (error) throw error;
            await this.loadInitialData();
            this.emit('tagAdded', data);
            return data;
        } catch (error) {
            console.error('Error adding tag:', error);
            this.emit('error', error.message);
            throw error;
        }
    }
 
    // Add this method
    async deleteTag(tagId) {
        try {
            const { error } = await this.supabase
                .from('tags')
                .delete()
                .eq('id', tagId);

            if (error) throw error;
            await this.loadInitialData();
            this.emit('tagDeleted', tagId);
        } catch (error) {
            console.error('Error deleting tag:', error);
            this.emit('error', error.message);
            throw error;
        }
    }

    // Add this method
    async updateTag(tagId, tagData) {
        try {
            const { data, error } = await this.supabase
                .from('tags')
                .update({
                    name: tagData.name,
                    color: tagData.color || null,
                    description: tagData.description || null
                })
                .eq('id', tagId)
                .select();

            if (error) throw error;
            await this.loadInitialData();
            this.emit('tagUpdated', data);
            return data;
        } catch (error) {
            console.error('Error updating tag:', error);
            this.emit('error', error.message);
            throw error;
        }
    }

    // Add this method
    async addFeature(featureData) {
        try {
            const { data, error } = await this.supabase
                .from('features')
                .insert([{
                    title: featureData.title,
                    description: featureData.description || null,
                    icon_class: featureData.icon_class || null
                }])
                .select();

            if (error) throw error;
            await this.loadInitialData();
            this.emit('featureAdded', data);
            return data;
        } catch (error) {
            console.error('Error adding feature:', error);
            this.emit('error', error.message);
            throw error;
        }
    }   
}




// 4 Tag Manager (separate from BlueprintStore)
class TagManager {
    constructor(store) {
        this.store = store;
        this.containerEl = document.getElementById('tag-cloud');
        this.bindEvents();
        this.bindStoreEvents();
    }



    bindStoreEvents() {
        this.store.on('loading', (isLoading) => {
            if (isLoading) {
                LoadingManager.show(this.containerEl);
            } else {
                LoadingManager.hide(this.containerEl);
            }
        });

        this.store.on('error', (message) => {
            LoadingManager.error(this.containerEl, message);
        });

        this.store.on('dataLoaded', () => {
            this.render();
        });
    }

    bindEvents() {
        document.getElementById('add-tag-btn').addEventListener('click', () => {
            this.showAddTagModal();
        });
    }

    showAddTagModal() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <h2>Add Tag</h2>
                <form id="tag-form">
                    <input type="text" name="name" placeholder="Tag Name" required>
                    <input type="text" name="color" placeholder="Color (e.g., #ff0000)" value="#3498db">
                    <textarea name="description" placeholder="Description"></textarea>
                    <button type="submit">Add Tag</button>
                    <button type="button" onclick="this.closest('.modal').remove()">Cancel</button>
                </form>
            </div>
        `;

        modal.querySelector('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                await this.store.addTag({
                    name: formData.get('name'),
                    color: formData.get('color'),
                    description: formData.get('description')
                });
                modal.remove();
            } catch (error) {
                alert('Error adding tag: ' + error.message);
            }
        });

        document.body.appendChild(modal);
    }

    async deleteTag(tagId) {
        if (confirm('Are you sure you want to delete this tag?')) {
            try {
                await this.store.deleteTag(tagId);
            } catch (error) {
                alert('Error deleting tag: ' + error.message);
            }
        }
    }

    render() {
        if (this.store.error) {
            this.containerEl.innerHTML = `<div class="error">${this.store.error}</div>`;
            return;
        }

        this.containerEl.innerHTML = `
            <div class="tag-grid">
                ${this.store.tags.map(tag => `
                    <div class="tag-item" style="border-left: 4px solid ${tag.color || '#3498db'}">
                        <div class="tag-content">
                            <span class="tag-name">${tag.name}</span>
                            ${tag.description ? `<p class="tag-description">${tag.description}</p>` : ''}
                        </div>
                        <button class="delete-btn" onclick="tagManager.deleteTag('${tag.id}')">Delete</button>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

 


class CategoryManager {
    constructor(store) {
        this.store = store;
        this.containerEl = document.getElementById('category-container');
        this.bindEvents();
        this.bindStoreEvents();
    }

    bindStoreEvents() {
        this.store.on('loading', (isLoading) => {
            if (isLoading) {
                LoadingManager.show(this.containerEl);
            } else {
                LoadingManager.hide(this.containerEl);
            }
        });

        this.store.on('error', (message) => {
            LoadingManager.error(this.containerEl, message);
        });

        this.store.on('dataLoaded', () => {
            this.render();
        });
    }

    bindEvents() {
        document.getElementById('add-category-btn').addEventListener('click', () => {
            this.showAddCategoryModal();
        });
    }

    showAddCategoryModal() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <h2>Add Category</h2>
                <form id="category-form">
                    <input type="text" name="name" placeholder="Category Name" required>
                    <input type="text" name="icon_class" placeholder="Icon Class">
                    <textarea name="description" placeholder="Description"></textarea>
                    <button type="submit">Add Category</button>
                    <button type="button" onclick="this.closest('.modal').remove()">Cancel</button>
                </form>
            </div>
        `;

        modal.querySelector('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                await this.store.addCategory({
                    name: formData.get('name'),
                    icon_class: formData.get('icon_class'),
                    description: formData.get('description')
                });
                modal.remove();
            } catch (error) {
                alert('Error adding category: ' + error.message);
            }
        });

        document.body.appendChild(modal);
    }

    async addSubcategory(categoryId) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <h2>Add Subcategory</h2>
                <form id="subcategory-form">
                    <input type="text" name="name" placeholder="Subcategory Name" required>
                    <textarea name="description" placeholder="Description"></textarea>
                    <button type="submit">Add Subcategory</button>
                    <button type="button" onclick="this.closest('.modal').remove()">Cancel</button>
                </form>
            </div>
        `;

        modal.querySelector('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            try {
                await this.store.addSubcategory(categoryId, {
                    name: formData.get('name'),
                    description: formData.get('description')
                });
                modal.remove();
            } catch (error) {
                alert('Error adding subcategory: ' + error.message);
            }
        });

        document.body.appendChild(modal);
    }

    async deleteCategory(categoryId) {
        if (confirm('Are you sure you want to delete this category? This will also delete all subcategories.')) {
            try {
                await this.store.deleteCategory(categoryId);
            } catch (error) {
                alert('Error deleting category: ' + error.message);
            }
        }
    }

    async deleteSubcategory(subcategoryId) {
        if (confirm('Are you sure you want to delete this subcategory?')) {
            try {
                const { error } = await this.store.supabase
                    .from('subcategories')
                    .delete()
                    .eq('id', subcategoryId);
                
                if (error) throw error;
                await this.store.loadInitialData();
            } catch (error) {
                alert('Error deleting subcategory: ' + error.message);
            }
        }
    }

    render() {
        if (this.store.error) {
            this.containerEl.innerHTML = `<div class="error">${this.store.error}</div>`;
            return;
        }

        this.containerEl.innerHTML = this.store.categories.map(category => `
            <div class="category-item" data-id="${category.id}">
                <div class="item">
                    <div class="category-icons">
                        
                        ${category.icon_class ? `<i 
                        class="${category.icon_class}"></i><strong>${category.name}</strong>` : ''}
                    </div>
                    <div class="category-actions indent">
                        <button class="border-1" onclick="categoryManager.addSubcategory('${category.id}')">Add Sub</button>
                        <button onclick="categoryManager.deleteCategory('${category.id}')" class="delete-btn">Delete</button>
                    </div>
                </div>
                ${category.description ? `<p class="category-description">${category.description}</p>` : ''}
                <ul class="subcategory-list">
                    ${(category.subcategories || []).map(sub => `
                        <li class="item">
                            <span>${sub.name}</span>
                            <button class="delete-btn" 
                                    onclick="categoryManager.deleteSubcategory('${sub.id}')">
                                Delete
                            </button>
                        </li>
                    `).join('')}
                </ul>
            </div>
        `).join('');
    }
}




document.addEventListener('DOMContentLoaded', async () => {
    try {
        const store = new BlueprintStore();
        window.categoryManager = new CategoryManager(store);
        window.tagManager = new TagManager(store);  // Add this line
        await store.loadInitialData();
    } catch (error) {
        console.error('Error initializing app:', error);
        document.getElementById('category-container').innerHTML = 
            `<div class="error">Error loading data: ${error.message}</div>`;
    }
});


    </script>
</body>
</html>